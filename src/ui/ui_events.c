// This file was generated by SquareLine Studio
// SquareLine Studio version: SquareLine Studio 1.5.0
// LVGL version: 8.3.11
// Project name: SquareLine_Project

#include "ui.h"
#include "hid_dev.h"
#include "esp_log.h"
#include "sequences.h"
#include "sounds.h"
#include "i2s_player.h"
#include "main.h"
#include "configration.h"

lv_obj_t *buttons[4];
int indices[4];

uint8_t strategemsAmount = 0;

#define INPUT_CTRL_MASK 1 // 1 CTRL left

void deselectStratagem(lv_event_t *e)
{
	for (uint8_t c = 0; c < 4; c++)
	{
		if (buttons[c] == e->target)
		{
			buttons[c] = NULL;
			indices[c] = 0;
		}
	}

	updateStratagemSelection();

	playbackSound("S:assets/sound/_des.wav");
}

void selectStratagem(lv_event_t *e)
{
	if (strategemsAmount < 4)
	{
		for (uint8_t c = 0; c < 4; c++)
		{
			if (buttons[c] == NULL)
			{
				buttons[c] = e->target;
				indices[c] = (int)lv_obj_get_user_data(e->target);
				break;
			}
		}

		updateStratagemSelection();

		playbackSound("S:assets/sound/_sel.wav");
	}
	else
	{
		lv_obj_clear_state(e->target, LV_STATE_CHECKED);

		playbackSound("S:assets/sound/_des.wav");
	}
}

void updateStratagemSelection()
{
	strategemsAmount = 0;

	for (uint8_t c = 0; c < 4; c++)
	{
		if (buttons[c] != NULL)
		{
			strategemsAmount++;
		}
	}

	lv_bar_set_value(uic_BarAmount, strategemsAmount, LV_ANIM_OFF);

	char textAmount[] = "0 / 4";
	textAmount[0] = (char)(strategemsAmount + '0');

	lv_label_set_text(uic_LabelAmount, &textAmount);

	if (strategemsAmount == 4)
	{
		GotoGame(NULL);
	}
}

void resetStratagems(lv_event_t *e)
{
	if (strategemsAmount == 0)
	{
		return;
	}

	for (uint8_t c = 0; c < 4; c++)
	{
		if (buttons[c] != NULL)
		{
			lv_obj_clear_state(buttons[c], LV_STATE_CHECKED);
			buttons[c] = NULL;
			indices[c] = 0;
		}
	}

	updateStratagemSelection();

	playbackSound("S:assets/sound/_rst.wav");
}

void assignStratagems(lv_event_t *e)
{
	// Weapons
	ui_WeaponsAC->user_data = 7;
	ui_WeaponsAMR->user_data = 1;
	ui_WeaponsARL->user_data = 15;
	ui_WeaponsAT->user_data = 13;
	ui_WeaponsC->user_data = 4;
	ui_WeaponsEAT->user_data = 3;
	ui_WeaponsFT->user_data = 6;
	ui_WeaponsGL->user_data = 11;
	ui_WeaponsHMG->user_data = 8;
	ui_WeaponsLC->user_data = 12;
	ui_WeaponsMG->user_data = 0;
	ui_WeaponsQC->user_data = 14;
	ui_WeaponsRG->user_data = 9;
	ui_WeaponsRR->user_data = 5;
	ui_WeaponsSPR->user_data = 10;
	ui_WeaponsSTE->user_data = 16;
	ui_WeaponsSW->user_data = 2;

	// Backpacks
	ui_BackpacksBSB->user_data = 19;
	ui_BackpacksEE->user_data = 25;
	ui_BackpacksGD->user_data = 21;
	ui_BackpacksGDB->user_data = 23;
	ui_BackpacksGDR->user_data = 22;
	ui_BackpacksJP->user_data = 17;
	ui_BackpacksPE->user_data = 24;
	ui_BackpacksSGP->user_data = 20;
	ui_BackpacksSUP->user_data = 18;
	ui_BackpacksDS->user_data = 57;
	ui_BackpacksFRV->user_data = 60;

	// Stationary
	ui_StationaryACS->user_data = 35;
	ui_StationaryAPM->user_data = 29;
	ui_StationaryATM->user_data = 31;
	ui_StationaryEMS->user_data = 37;
	ui_StationaryGS->user_data = 33;
	ui_StationaryHMGE->user_data = 26;
	ui_StationaryIM->user_data = 30;
	ui_StationaryMGS->user_data = 32;
	ui_StationaryMS->user_data = 34;
	ui_StationaryRS->user_data = 36;
	ui_StationarySGR->user_data = 27;
	ui_StationaryTT->user_data = 28;
	ui_StationaryATE->user_data = 58;
	ui_StationaryFS->user_data = 59;

	// Strikes
	ui_Strikes120->user_data = 40;
	ui_Strikes380->user_data = 41;
	ui_StrikesOAS->user_data = 39;
	ui_StrikesOES->user_data = 47;
	ui_StrikesOGB->user_data = 38;
	ui_StrikesOGS->user_data = 46;
	ui_StrikesOL->user_data = 43;
	ui_StrikesONB->user_data = 49;
	ui_StrikesOPS->user_data = 45;
	ui_StrikesORS->user_data = 44;
	ui_StrikesOSS->user_data = 48;
	ui_StrikesOWB->user_data = 42;

	// Eagle
	ui_Eagle110->user_data = 55;
	ui_Eagle500->user_data = 56;
	ui_EagleA->user_data = 51;
	ui_EagleCB->user_data = 52;
	ui_EagleNA->user_data = 53;
	ui_EagleSR->user_data = 50;
	ui_EagleSS->user_data = 54;
}

void triggerStratagemStd1(lv_event_t *e)
{
	// Reinforce
	uint8_t sequence[8] = {INPUT_UP,
						   INPUT_DOWN,
						   INPUT_RIGHT,
						   INPUT_LEFT,
						   INPUT_UP,
						   0,
						   0,
						   0};

	setStratagemCode(sequence, INPUT_CTRL_MASK);

	playbackSound("S:assets/sound/reinf.wav");
}

void triggerStratagemStd2(lv_event_t *e)
{
	// Resupply
	uint8_t sequence[8] = {INPUT_DOWN,
						   INPUT_DOWN,
						   INPUT_UP,
						   INPUT_RIGHT,
						   0,
						   0,
						   0,
						   0};

	setStratagemCode(sequence, INPUT_CTRL_MASK);

	playbackSound("S:assets/sound/supp.wav");
}

void triggerStratagemStd3(lv_event_t *e)
{
	// SOS
	uint8_t sequence[8] = {INPUT_UP,
						   INPUT_DOWN,
						   INPUT_RIGHT,
						   INPUT_UP,
						   0,
						   0,
						   0,
						   0};

	setStratagemCode(sequence, INPUT_CTRL_MASK);

	playbackSound("S:assets/sound/sos.wav");
}

void triggerStratagemStd4(lv_event_t *e)
{
	// Eagle rearm
	uint8_t sequence[8] = {INPUT_UP,
						   INPUT_UP,
						   INPUT_LEFT,
						   INPUT_UP,
						   INPUT_RIGHT,
						   0,
						   0,
						   0};

	setStratagemCode(sequence, INPUT_CTRL_MASK);

	playbackSound("S:assets/sound/eagrel.wav");
}

void triggerStratagemStd5(lv_event_t *e)
{
	// Hellbomb
	uint8_t sequence[8] = {INPUT_DOWN,
						   INPUT_UP,
						   INPUT_LEFT,
						   INPUT_DOWN,
						   INPUT_UP,
						   INPUT_RIGHT,
						   INPUT_DOWN,
						   INPUT_UP};

	setStratagemCode(sequence, INPUT_CTRL_MASK);

	// playbackSound("S:assets/sound/.wav");
}

void triggerStratagemStd6(lv_event_t *e)
{
	// S.E.A.F. Artillery
	uint8_t sequence[8] = {INPUT_RIGHT,
						   INPUT_UP,
						   INPUT_UP,
						   INPUT_DOWN,
						   0,
						   0,
						   0,
						   0};

	setStratagemCode(sequence, INPUT_CTRL_MASK);

	// playbackSound("S:assets/sound/.wav");
}

void triggerStratagemUser1(lv_event_t *e)
{
	uint8_t itemIndex = indices[0];

	setStratagemCode(sequences[itemIndex], INPUT_CTRL_MASK);

	uint8_t soundIndex = soundMap[itemIndex];
	char *path = soundFiles[soundIndex];

	playbackSound(path);
}

void triggerStratagemUser2(lv_event_t *e)
{
	uint8_t itemIndex = indices[1];

	setStratagemCode(sequences[itemIndex], INPUT_CTRL_MASK);

	uint8_t soundIndex = soundMap[itemIndex];
	char *path = soundFiles[soundIndex];

	playbackSound(path);
}

void triggerStratagemUser3(lv_event_t *e)
{
	uint8_t itemIndex = indices[2];

	setStratagemCode(sequences[itemIndex], INPUT_CTRL_MASK);

	uint8_t soundIndex = soundMap[itemIndex];
	char *path = soundFiles[soundIndex];

	playbackSound(path);
}

void triggerStratagemUser4(lv_event_t *e)
{
	uint8_t itemIndex = indices[3];

	setStratagemCode(sequences[itemIndex], INPUT_CTRL_MASK);

	uint8_t soundIndex = soundMap[itemIndex];
	char *path = soundFiles[soundIndex];

	playbackSound(path);
}

void ChangeDelay(lv_event_t *e)
{
	int32_t delay = lv_slider_get_value(e->target);

	setDelay(delay * 10, false);
}

void ChangeBrightness(lv_event_t *e)
{
	int32_t brightness = lv_slider_get_value(e->target);

	setBrightness(brightness * 10, false);
}

void MuteSound(lv_event_t *e)
{
	bool muted = lv_obj_get_state(e->target) & LV_STATE_CHECKED ? true : false;

	setMuted(muted, false);
}

void ResetConfig(lv_event_t *e)
{
	resetConfig();
}

void KeyboardDemo(lv_event_t *e)
{
	uint8_t sequence[8] = {HID_KEY_H,
						   HID_KEY_E,
						   HID_KEY_L,
						   HID_KEY_L,
						   HID_KEY_O,
						   0,
						   0,
						   0};

	setStratagemCode(sequence, 0);
}

void RebootDevice(lv_event_t *e)
{
	esp_restart();
}

void TabChanged(lv_event_t *e)
{
	playbackSound("S:assets/sound/_swp.wav");
}

void FlipScreen(lv_event_t *e)
{
	bool flip = lv_obj_get_state(e->target) & LV_STATE_CHECKED ? true : false;

	setRotation(flip ? LV_DISP_ROT_270 : LV_DISP_ROT_90, false);
}

void GotoGame(lv_event_t *e)
{
	for (uint8_t c = 0; c < 4; c++)
	{
		const lv_obj_t *button = buttons[c];
		const lv_img_dsc_t *bgImg = lv_obj_get_style_bg_img_src(button, LV_PART_MAIN | LV_STATE_DEFAULT);
		const bool configured = buttons[c] != NULL;
		lv_obj_t *targetButton = ui_CustomStratagem1;

		const lv_img_dsc_t *hires = ResolveHiResIcon(bgImg);

		switch (c)
		{
		case 1:
			targetButton = ui_CustomStratagem2;
			break;
		case 2:
			targetButton = ui_CustomStratagem3;
			break;
		case 3:
			targetButton = ui_CustomStratagem4;
			break;
		}

		if (configured)
		{
			lv_obj_clear_flag(targetButton, LV_OBJ_FLAG_HIDDEN);
			lv_obj_set_style_bg_img_src(targetButton, hires, LV_PART_MAIN | LV_STATE_DEFAULT);
		}
		else
		{
			lv_obj_add_flag(targetButton, LV_OBJ_FLAG_HIDDEN);
		}
	}

	_ui_screen_change(&ui_Game, LV_SCR_LOAD_ANIM_MOVE_LEFT, 1000, 100, &ui_Game_screen_init);
}

lv_img_dsc_t* ResolveHiResIcon(lv_img_dsc_t* icon)
{
	lv_img_dsc_t *hires;

	if (icon == ui_imgset_[0])
	{
		hires = ui_imgset_ft[1];
	}
	else if (icon == ui_imgset_[2])
	{
		hires = ui_imgset_ft[3];
	}
	else if (icon == ui_imgset_ac[0])
	{
		hires = ui_imgset_ac[1];
	}
	else if (icon == ui_imgset_acs[0])
	{
		hires = ui_imgset_acs[1];
	}
	else if (icon == ui_imgset_amr[0])
	{
		hires = ui_imgset_amr[1];
	}
	else if (icon == ui_imgset_apm[0])
	{
		hires = ui_imgset_apm[1];
	}
	else if (icon == ui_imgset_arl[0])
	{
		hires = ui_imgset_arl[1];
	}
	else if (icon == ui_imgset_at[0])
	{
		hires = ui_imgset_at[1];
	}
	else if (icon == ui_imgset_ate[0])
	{
		hires = ui_imgset_ate[1];
	}
	else if (icon == ui_imgset_atm[0])
	{
		hires = ui_imgset_atm[1];
	}
	else if (icon == ui_imgset_bsb[0])
	{
		hires = ui_imgset_bsb[1];
	}
	else if (icon == ui_imgset_c[0])
	{
		hires = ui_imgset_c[1];
	}
	else if (icon == ui_imgset_ds[0])
	{
		hires = ui_imgset_ds[1];
	}
	else if (icon == ui_imgset_e[0])
	{
		hires = ui_imgset_e[1];
	}
	else if (icon == ui_imgset_e[2])
	{
		hires = ui_imgset_e[3];
	}
	else if (icon == ui_imgset_ea[0])
	{
		hires = ui_imgset_ea[1];
	}
	else if (icon == ui_imgset_eat[0])
	{
		hires = ui_imgset_eat[1];
	}
	else if (icon == ui_imgset_ecb[0])
	{
		hires = ui_imgset_ecb[1];
	}
	else if (icon == ui_imgset_ee[0])
	{
		hires = ui_imgset_ee[1];
	}
	else if (icon == ui_imgset_ems[0])
	{
		hires = ui_imgset_ems[1];
	}
	else if (icon == ui_imgset_ena[0])
	{
		hires = ui_imgset_ena[1];
	}
	else if (icon == ui_imgset_esr[0])
	{
		hires = ui_imgset_esr[1];
	}
	else if (icon == ui_imgset_ess[0])
	{
		hires = ui_imgset_ess[1];
	}
	else if (icon == ui_imgset_frv[0])
	{
		hires = ui_imgset_frv[1];
	}
	else if (icon == ui_imgset_fs[0])
	{
		hires = ui_imgset_fs[1];
	}
	else if (icon == ui_imgset_ft[0])
	{
		hires = ui_imgset_ft[1];
	}
	else if (icon == ui_imgset_gd[0])
	{
		hires = ui_imgset_gd[1];
	}
	else if (icon == ui_imgset_gdb[0])
	{
		hires = ui_imgset_gdb[1];
	}
	else if (icon == ui_imgset_gdr[0])
	{
		hires = ui_imgset_gdr[1];
	}
	else if (icon == ui_imgset_gl[0])
	{
		hires = ui_imgset_gl[1];
	}
	else if (icon == ui_imgset_gs[0])
	{
		hires = ui_imgset_gs[1];
	}
	else if (icon == ui_imgset_hmg[0])
	{
		hires = ui_imgset_hmg[1];
	}
	else if (icon == ui_imgset_hmge[0])
	{
		hires = ui_imgset_hmge[1];
	}
	else if (icon == ui_imgset_im[0])
	{
		hires = ui_imgset_im[1];
	}
	else if (icon == ui_imgset_jp[0])
	{
		hires = ui_imgset_jp[1];
	}
	else if (icon == ui_imgset_lc[0])
	{
		hires = ui_imgset_lc[1];
	}
	else if (icon == ui_imgset_mg[0])
	{
		hires = ui_imgset_mg[1];
	}
	else if (icon == ui_imgset_mgs[0])
	{
		hires = ui_imgset_mgs[1];
	}
	else if (icon == ui_imgset_ms[0])
	{
		hires = ui_imgset_ms[1];
	}
	else if (icon == ui_imgset_oas[0])
	{
		hires = ui_imgset_oas[1];
	}
	else if (icon == ui_imgset_oes[0])
	{
		hires = ui_imgset_oes[1];
	}
	else if (icon == ui_imgset_ogb[0])
	{
		hires = ui_imgset_ogb[1];
	}
	else if (icon == ui_imgset_ogs[0])
	{
		hires = ui_imgset_ogs[1];
	}
	else if (icon == ui_imgset_ol[0])
	{
		hires = ui_imgset_ol[1];
	}
	else if (icon == ui_imgset_onb[0])
	{
		hires = ui_imgset_onb[1];
	}
	else if (icon == ui_imgset_ops[0])
	{
		hires = ui_imgset_ops[1];
	}
	else if (icon == ui_imgset_ors[0])
	{
		hires = ui_imgset_ors[1];
	}
	else if (icon == ui_imgset_oss[0])
	{
		hires = ui_imgset_oss[1];
	}
	else if (icon == ui_imgset_owb[0])
	{
		hires = ui_imgset_owb[1];
	}
	else if (icon == ui_imgset_pe[0])
	{
		hires = ui_imgset_pe[1];
	}
	else if (icon == ui_imgset_qc[0])
	{
		hires = ui_imgset_qc[1];
	}
	else if (icon == ui_imgset_rg[0])
	{
		hires = ui_imgset_rg[1];
	}
	else if (icon == ui_imgset_rr[0])
	{
		hires = ui_imgset_rr[1];
	}
	else if (icon == ui_imgset_rs[0])
	{
		hires = ui_imgset_rs[1];
	}
	else if (icon == ui_imgset_sgp[0])
	{
		hires = ui_imgset_sgp[1];
	}
	else if (icon == ui_imgset_sgr[0])
	{
		hires = ui_imgset_sgr[1];
	}
	else if (icon == ui_imgset_spr[0])
	{
		hires = ui_imgset_spr[1];
	}
	else if (icon == ui_imgset_ste[0])
	{
		hires = ui_imgset_ste[1];
	}
	else if (icon == ui_imgset_sup[0])
	{
		hires = ui_imgset_sup[1];
	}
	else if (icon == ui_imgset_sw[0])
	{
		hires = ui_imgset_sw[1];
	}
	else if (icon == ui_imgset_tt[0])
	{
		hires = ui_imgset_tt[1];
	}

	return hires;
}